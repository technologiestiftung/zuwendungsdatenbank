"use strict";var yearChart=function(t,e,a,n,r,i){var o,s,d,u,c,l,p={},f=i,g=n,h=r,m=[],x=!0,v=t,b=e,y=a,k=j(e,a),z=d3.scaleTime().domain([b.all()[0].key,b.all()[b.size()-1].key]),w=d3.axisBottom().scale(z).tickFormat(d3.format("d")),F=d3.scaleLinear(),S=d3.scaleLinear(),A=d3.axisRight().ticks(10).scale(S),L=d3.axisLeft().ticks(10).scale(F).tickFormat(function(t){return t>=1e9?(t/1e9).toFixed(2)+" Mrd. €":t>=1e6?(t/1e6).toFixed(0)+" Mio. €":t>=1e3?(t/1e3).toFixed(2)+" Tsd. €":t}),O=v.append("svg").classed("dateChart",!0);O.append("defs").selectAll("pattern").data(["texture","texture_blue","texture_grey"]).enter().append("pattern").attr("id",function(t){return t}).attr("width",5).attr("height",5).attr("patternUnits","userSpaceOnUse").append("image").attr("xlink:href",function(t){return"./images/"+t+".png"}).attr("width",5).attr("height",5);var X=O.append("g").attr("transform","translate(160,20)"),Y=O.append("g").attr("transform","translate(160,20)").selectAll("g").data(k).enter().append("g").on("click",function(t){g(h,t.date.key),U(d3.event.pageX,d3.event.pageY,t)}).classed("dategroup",!0).on("mousemove",function(t){f.move({x:d3.event.pageX,y:d3.event.pageY})}).on("mouseover",function(t){U(d3.event.pageX,d3.event.pageY,t)}).on("mouseout",function(t){f.hide()}),_=X.append("text").text("Summe (€)").style("font-weight","bold").attr("text-anchor","end"),C=X.append("text").text("Anzahl").style("font-weight","bold"),M=Y.append("rect"),T=Y.append("rect").classed("counts",!0);function U(t,e,a){var n=!1;(0==m.length||m.indexOf(a.date.key)>-1)&&(n=!0),f.direction("horizontal"),f.show({title:a.count.key,body:"Summe in €:<br /><i>".concat(currency(a.date.value))+(n?"&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;".concat((a.date.value/all.value()*100).toFixed(2),"%"):"")+"</i><br><br />Anzahl Förderprojekte:<br /><i>".concat(a.count.value)+(n?"&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;".concat((a.count.value/all_groups.value()*100).toFixed(2),"%"):"")+"</i>",x:t,y:e})}function j(t,e){var a=[];return t.all().forEach(function(t,n){a.push({date:t,count:e.all()[n]})}),a}return p.init=function(){c=X.append("g").classed("yaxis",!0).attr("transform","translate(-10,0)"),l=X.append("g").attr("class","yaxis right"),u=X.append("g").classed("xaxis",!0),p.resize()},p.data=function(t,e,a){b=t,y=e,k=j(t,e),m=a,O.classed("hasSelection",m.length>0),p.update()},p.update=function(){F.domain([0,d3.max(b.all(),function(t){return t.value})]),S.domain([0,d3.max(y.all(),function(t){return t.value})]),Y.data(k).classed("selected",function(t){return m.indexOf(t.date.key)>-1}).transition().duration(x?0:500).attr("transform",function(t,e){return"translate("+z(t.date.key)+",0)"}),M.transition().duration(x?0:500).attr("y",function(t,e){return F(t.date.value)}).attr("width",function(t,e){return d/2}).attr("height",function(t,e){return s-30-20-F(t.date.value)}),T.transition().duration(x?0:500).attr("x",d/2).attr("y",function(t,e){return S(t.count.value)}).attr("width",function(t,e){return d/2}).attr("height",function(t,e){return s-30-20-S(t.count.value)}),c.transition().duration(x?0:500).call(L),l.transition().duration(x?0:500).call(A),u.transition().duration(x?0:500).call(w),x=!1},p.resize=function(){o=v.node().offsetWidth,s=v.node().offsetHeight,d=(o-20-150-10*b.size())/(b.size()+1),z.range([0,o-30-2*d-150]),F.range([s-30-20,0]),S.range([s-30-20,0]),O.attr("width",o),O.attr("height",s),_.attr("transform","translate(-13,-10)"),C.attr("transform","translate("+(o-20-150-d+3)+","+-10+")"),L.tickSize(-(o-10-150-d),0,0),A.tickSize(-(o-10-150-d),0,0),l.attr("transform","translate("+(o-20-150-d)+",0)"),u.attr("transform","translate("+d/2+","+(s-30-20)+")"),p.update()},p};