"use strict";var yearChart=function(t,e,a,n,r,i){var o,s,d,u,c,l,p={},f=i,g=n,h=r,m=[],x=!0,v=t,b=e,y=a,k=H(e,a),w=d3.scaleTime().domain([b.all()[0].key,b.all()[b.size()-1].key]),z=d3.axisBottom().scale(w).tickFormat(d3.format("d")),F=d3.scaleLinear(),S=d3.scaleLinear(),L=d3.axisRight().ticks(10).scale(S),O=d3.axisLeft().ticks(10).scale(F).tickFormat(function(t){return t>=1e9?(t/1e9).toFixed(2)+" Bil. €":t>=1e6?(t/1e6).toFixed(0)+" Mil. €":t>=1e3?(t/1e3).toFixed(2)+" K €":t}),X=v.append("svg").classed("dateChart",!0);X.append("defs").selectAll("pattern").data(["texture","texture_blue","texture_grey"]).enter().append("pattern").attr("id",function(t){return t}).attr("width",5).attr("height",5).attr("patternUnits","userSpaceOnUse").append("image").attr("xlink:href",function(t){return"./images/"+t+".png"}).attr("width",5).attr("height",5);var Y=X.append("g").attr("transform","translate(160,20)"),_=X.append("g").attr("transform","translate(160,20)").selectAll("g").data(k).enter().append("g").on("click",function(t){g(h,t.date.key),E(d3.event.pageX,d3.event.pageY,t)}).classed("dategroup",!0).on("mousemove",function(t){f.move({x:d3.event.pageX,y:d3.event.pageY})}).on("mouseover",function(t){E(d3.event.pageX,d3.event.pageY,t)}).on("mouseout",function(t){f.hide()}),A=Y.append("text").text("Sum (€)").style("font-weight","bold").attr("text-anchor","end"),B=Y.append("text").text("count").style("font-weight","bold"),C=_.append("rect"),U=_.append("rect").classed("counts",!0);function E(t,e,a){var n=!1;(0==m.length||m.indexOf(a.date.key)>-1)&&(n=!0),f.direction("horizontal"),f.show({title:a.count.key,body:"Sum in €:<br /><i>".concat(currency(a.date.value))+(n?"&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;".concat((a.date.value/all.value()*100).toFixed(2),"%"):"")+"</i><br><br />Number of grants:<br /><i>".concat(a.count.value)+(n?"&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;".concat((a.count.value/all_groups.value()*100).toFixed(2),"%"):"")+"</i>",x:t,y:e})}function H(t,e){var a=[];return t.all().forEach(function(t,n){a.push({date:t,count:e.all()[n]})}),a}return p.init=function(){c=Y.append("g").classed("yaxis",!0).attr("transform","translate(-10,0)"),l=Y.append("g").attr("class","yaxis right"),u=Y.append("g").classed("xaxis",!0),p.resize()},p.data=function(t,e,a){b=t,y=e,k=H(t,e),m=a,X.classed("hasSelection",m.length>0),p.update()},p.update=function(){F.domain([0,d3.max(b.all(),function(t){return t.value})]),S.domain([0,d3.max(y.all(),function(t){return t.value})]),_.data(k).classed("selected",function(t){return m.indexOf(t.date.key)>-1}).transition().duration(x?0:500).attr("transform",function(t,e){return"translate("+w(t.date.key)+",0)"}),C.transition().duration(x?0:500).attr("y",function(t,e){return F(t.date.value)}).attr("width",function(t,e){return d/2}).attr("height",function(t,e){return s-30-20-F(t.date.value)}),U.transition().duration(x?0:500).attr("x",d/2).attr("y",function(t,e){return S(t.count.value)}).attr("width",function(t,e){return d/2}).attr("height",function(t,e){return s-30-20-S(t.count.value)}),c.transition().duration(x?0:500).call(O),l.transition().duration(x?0:500).call(L),u.transition().duration(x?0:500).call(z),x=!1},p.resize=function(){o=v.node().offsetWidth,s=v.node().offsetHeight,d=(o-20-150-10*b.size())/(b.size()+1),w.range([0,o-30-2*d-150]),F.range([s-30-20,0]),S.range([s-30-20,0]),X.attr("width",o),X.attr("height",s),A.attr("transform","translate(-13,-10)"),B.attr("transform","translate("+(o-20-150-d+3)+","+-10+")"),O.tickSize(-(o-10-150-d),0,0),L.tickSize(-(o-10-150-d),0,0),l.attr("transform","translate("+(o-20-150-d)+",0)"),u.attr("transform","translate("+d/2+","+(s-30-20)+")"),p.update()},p};